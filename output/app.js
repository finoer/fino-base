!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){!function(t){"use strict";function e(t,e){window.FINO||(window.FINO={}),window.FINO[t]=e}let n=[];class i{constructor(){this.namespace="",this.data={},this.existingProxy=[]}init(t){if(!t)throw new Error("请传入命名空间");this.namespace=t}set(t,e){if(e&&function(t){const e=new i;return Object.keys(e).includes(t)}(e))return void console.error(e+"是数据仓库的关键字，请更改命名空间");if("object"!=typeof(n=t)||null===n)return void console.error("设置的数据必须是一个对象");var n;const s=e||this.namespace;let o=this.data[s]||{};this.data[s]=Object.assign(o,t,{_spacename:s});for(let e in t)this.proxyOfprototype(t,s,e);this.data[s]=this.proxyOfcontent(s)}get(t,e){return!t&&e?this.data[this.namespace]:t&&!e&&this.data[this.namespace]&&void 0!==this.data[this.namespace][t]?this.data[this.namespace][t]:e&&t&&this.data[e]?this.data[e][t]:void 0}clear(){this.data[this.namespace]&&(Object.keys(this.data[this.namespace]).forEach(t=>{"spacename"!==t&&delete this[t]}),this.data[this.namespace]=null)}proxyOfprototype(t,e,n){if("_spacename"===n)return;console.log(t);const i=e||this.namespace,s={get:()=>this.data[i][n],set:t=>{this.data[n]=t,this.data[i][n]=t},enumerable:!0,configurable:!0};Object.defineProperty(this,n,s)}proxyOfcontent(t){if(this.existingProxy.includes(t))return this.data[t];let e=new Proxy(this.data[t],{get:(t,e,n)=>Reflect.get(t,e,n),set:(t,e,n,i)=>{const s=t[e];return t._spacename!==this.namespace&&"global"!==t._spacename?(console.error("不允许修改其他数据仓库的数据"),s):Reflect.set(t,e,n,i)}});return this.existingProxy.push(t),e}}console.log("databnase改变了最终版8");class s{constructor(){this.activeAppInfo={app:"",context:"",version:""},this.contextSourceCache={},this.activedApplication=n[0],this.activeContext=Window}setRuntimeContext(t){this.activeContext=t}}const o=function(){const t=window;return t.globalContext||(t.globalContext=new s),t.globalContext}();function a(t){let e=document.getElementById(t);e&&document.body.removeChild(e)}function r(t){return o.activeAppInfo=t,t}function c(t){return o.activedApplication=t,t}class p{constructor(){this._events={}}subscribe(t,e,n){if(this._events[t]){if(this._events[t].indexOf(e)>-1)return;n?this._events[t].unshift(e):this._events[t].push(e)}else this._events[t]=[e]}notify(t,e){let n=e||[];this._events[t]&&this._events[t].forEach(t=>t.call(this,n))}removeListener(t,e){this._events[t]&&this._events[t].filter(t=>t!==e&&t.orign!==e)}prepend(t,e){this.subscribe(t,e,!0)}}var u;function h(t){let{scriptTag:e,timestamp:n}=m();return new Promise((i,s)=>{e.onload=()=>i(null),e.onerror=o=>{setTimeout(()=>{document.head.removeChild(e);let a=m();a.scriptTag.onload=i,a.scriptTag.onerror=s,a.scriptTag.src=t+"?"+n,document.head.appendChild(a.scriptTag),s(o)},1e3)},e.src=t+"?"+n,e.id=""+t,document.body.appendChild(e)})}function d(t){let{styleTag:e,timestamp:n}=function(){const t=document.createElement("link"),e=+new Date;return t.id="timestamp",{styleTag:t,timestamp:e}}();return new Promise(i=>{e.onload=()=>i(null),e.href=t+"?"+n,e.rel="stylesheet",e.id=""+t,document.body.appendChild(e),i(null)})}function l(t){return new Promise((e,n)=>{h(t).then(()=>{e(o.activeAppInfo)}).catch(t=>{n(t)})})}function m(){const t=document.createElement("script"),e=+new Date;return t.type="text/javascript",t.id="timestamp",{scriptTag:t,timestamp:e}}!function(t){t.INLINE="inline",t.EXTERNAL="external"}(u||(u={}));class f{constructor(t){this.baseUrl="https://cdn.bootcdn.net/ajax/libs",this.context="",this.context=t}getSandBoxJs(t,e){return h(`${this.baseUrl}/${t}/${e}/${t}.min.js`)}}class w extends f{constructor(){super("vue")}async getContextResource(t){if(o.contextSourceCache.vue)return;const e=await this.getSandBoxJs("vue",t);return await this.getSandBoxJs("vue-router","3.4.3"),o.contextSourceCache.vue=!0,o.contextSourceCache.vueRouter=!0,e}createContext(t){let e=document.createElement("div");e.setAttribute("id","fino-vue-root"),document.body.appendChild(e),window.Vue2=window.Vue||window.Vue2,window.Vue=void 0;const n=window.Vue2,i=window.VueRouter;n.use(i);const s=new i({mode:"history",routes:[]});return window.vm=new n({el:e,router:s,render:t=>t("div",{attrs:{id:"fino-vue-root"}},[t("RouterView")])})}injectionRouter(t){this.instance&&(this.instance.$router.addRoutes(t),this.instance.$router.options.routes=t)}destroy(){this.instance&&this.instance.$destroy();const t=document.getElementById("fino-vue-root");t&&document.body.removeChild(t)}}class v extends f{constructor(){super("phaser")}async getContextResource(t){if(o.contextSourceCache.phaser)return;await this.getSandBoxJs("phaser",t);const e=window.Phaser;return o.contextSourceCache.phaser=!0,o.contextSourceCache.SpinePlugin=!0,e}createContext(){}initGame(t){const e=document.createElement("div");e.id="root",document.body.appendChild(e);const n={type:Phaser.AUTO,width:window.innerWidth,height:window.innerHeight,resolution:2,autoFocus:!0,transparent:!0,parent:e,scene:t,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH}};return new Phaser.Game(n)}injectionRouter(t){this.instance||(this.instance=this.initGame([t[t.length-1]]),t.pop());let e=document.querySelector("#root");e&&e.setAttribute("style","display: block"),Object.keys(t).map((e,n)=>{this.instance&&this.instance.scene.add(t[e].name,t[n])})}destroy(){if(!this.instance)return;let t=document.querySelector("#root");t&&document.body.removeChild(t),this.instance.destroy(!0),this.instance.plugins.removeScenePlugin("SpinePlugin")}}function y(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n)}class x{constructor(t){this.type="Snapshot",this.sandboxRunning=!0,this.modifyPropsMap={},this.appCache=[],this.name=t,this.proxy=window}active(){const t=window;this.windowSnapshot={},this.modifyPropsMap[this.name]=this.modifyPropsMap[this.name]||{},!this.appCache.includes(this.name)&&this.appCache.push(this.name),y(t,e=>{this.windowSnapshot[e]=t[e]}),Object.keys(this.modifyPropsMap[this.name]).forEach(e=>{t[e]=this.modifyPropsMap[this.name][e]}),this.sandboxRunning=!0}inactive(){const t=window;this.windowSnapshot&&this.name&&(this.modifyPropsMap[this.name]={},y(window,e=>{t[e]!==this.windowSnapshot[e]&&(this.modifyPropsMap[this.name][e]=t[e],t[e]=this.windowSnapshot[e])}),this.sandboxRunning=!1)}}const g=window.setInterval,b=window.clearInterval;async function C(t,e){const n=o.activeContext;return"MOUNT"===t.status&&(o.activedApplication=t,e.name=t.name,e.active()),t.dynamicElements.css&&await async function(t){for(let e=0;e<t.length;e++)await d(t[e])}(t.dynamicElements.css),t.name===o.activedApplication.name&&o.activedApplication.init&&o.activedApplication.init(n,o.activeContext),t.status="MOUNT",t}var j;window.intervals=[],function(t){t.BOOTSTRAP="bootstrap",t.MOUNTED="mount"}(j||(j={}));const O={bootstrap:async function(t,e,n){let i;const s=t.domain+t.entry;return i=await l(s),e.appCache.includes(t.name)||(e.name=t.name,e.active()),o.activedApplication=await n(t.domain,o.activeAppInfo),a(t.domain+t.entry),C(t,e)},mount:C};let E=!0;const S=["popstate","hashChange"],P={popstate:[],hashChange:[]};function A(t,e){return n=P[t],i=e,!!Array.isArray(n)&&n.filter(t=>t===i).length>0;var n,i}const M=window.addEventListener,T=window.removeEventListener,I=window.history.pushState,_=window.history.replaceState,$=window,R=$.$data=$.$data?$.$data:new i,k=new class{constructor(){this.runtimeInfino=!0,this.appList=[],this.app=n[0],this.mode="speed";const t=window;this.$event=t.$event=new p,this.sandbox=new x(""),function(t){t.$event&&(t.$event.subscribe("baseInfoLoaded",r),t.$event.subscribe("childAppLoaded",c))}(t),this.free=function(t){const e=window;return t.clearInterval=t=>(e.intervals=e.intervals.filter(e=>e!==t),b(t)),t.setInterval=(t,n,...i)=>{const s=g(t,n,...i);return console.log("intervalId",s),e.intervals.includes(s)||(e.intervals=[...e.intervals,s]),s},function(){e.intervals.forEach(e=>{t.clearInterval(e)})}}(window)}init(t){return t.map((t,e)=>{t.status="BOOTSTRAP"}),this.appList=t,this.performAppChnage(this.appList),this.appList}async performAppChnage(t){const e=function(t){let e={app:t[0],index:0};return t.forEach((t,n)=>{t.activeWhen(window.location)&&t.status&&("UNMOUNT"===t.status&&(t.status="BOOTSTRAP"),e={app:t,index:n})}),e}(t);this.app=e.app,this.app.dynamicElements=this.app.dynamicElements||{js:[],css:[]};const i=function(t){let e=[];return t.forEach((t,n)=>{t.activeWhen(window.location)||"MOUNT"!==t.status||e.push({app:t,index:n})}),e}(t);E||this.free(),E=!1,i&&await async function(t,e,n){return new Promise(i=>{t||i();for(let e=0;e<t.length;e++)if(t[e].app.dynamicElements.js){for(let n=0;n<t[e].app.dynamicElements.js.length;n++)a(t[e].app.dynamicElements.js[n]);for(let n=0;n<t[e].app.dynamicElements.css.length;n++)a(t[e].app.dynamicElements.css[n]);"safe"===n&&(t[e].app.dynamicElements.js=[],t[e].app.status="UNMOUNT")}e.inactive(),i()})}(i,this.sandbox,this.mode),"MOUNT"===this.app.status&&(o.activedApplication=this.app),this.app.init||this.$event.notify("appLeave"),o.activeContext=await this.setRuntimeContext(this.app);const s=this.app.status.toLocaleLowerCase();this.app=await O[s](this.app,this.sandbox,this.getModuleJs.bind(this)),this.app=Object.assign(this.app,o.activeAppInfo,o.activedApplication),n[e.index]=this.app,this.$event.notify("appEnter")}async setRuntimeContext(t){if(!t)return o.activeContext;let e=o.activeContext;return this.app.context&&this.app.context===o.activeContext.context?e=o.activeContext:(t.context&&Object.assign(o.activeAppInfo,{context:t.context,version:t.version}),e&&e.destroy&&e.destroy(),e=o.activeContext=await async function(t,e){const n=new{vue:w,phaser:v}[t];return await n.getContextResource(e),n.instance=n.createContext(e),n}(o.activeAppInfo.context,o.activeAppInfo.version)),e}async getModuleJs(t,e){for(let n=0;n<e.length;n++)if("string"!=typeof e[n]);else{const i=e[n],s=t+"/"+i;if(i.indexOf(".css")>-1){-1===this.app.dynamicElements.css.indexOf(s)&&this.app.dynamicElements.css.push(s);continue}i.indexOf(".js")>-1?await l(s):(new Image).src=s,"safe"===this.mode&&this.app.dynamicElements.js.push(s)}return o.activedApplication}isInFinoRuntime(){return!!function(t){const e=window.FINO;return e&&e[t]?e[t]:null}("root")}start(){e("root","root")}},L=new class{constructor(t){this.invoke=t,this.hijackHistory(),this.hijackEventListener()}reroute(){this.invoke.app&&this.invoke.performAppChnage(n)}push(t){window.history.pushState(null,"",t)}hijackHistory(){const t=this;window.history.pushState=function(e,n,i,...s){let o=I.apply(this,[e,n,i]);return t.reroute(),o},window.history.replaceState=function(e,n,i,...s){let o=_.apply(this,[e,n,i]);return t.reroute(),o},window.onpopstate=e=>{t.reroute()},window.addEventListener("popstate",()=>{t.reroute()},!1)}hijackEventListener(){window.addEventListener=(t,e,n)=>{if(!("function"==typeof e&&S.indexOf(t)>-1)||A(t,e))return M.apply(window,[t,e,n]);!function(t,e){P[t].push(e)}(t,e)},window.removeEventListener=(t,e,n)=>{if(!("function"==typeof e&&S.indexOf(t)>=0))return T.apply(window,[t,e,n]);!function(t,e){P[t]=P[t].filter(t=>t!==e)}(t,e)}}handlePopState(t){}}(k);k.$event.subscribe("appEnter",()=>{$.$data&&$.$data.init(k.app.name)}),t.$data=R,t.invoke=k,t.registerApps=function(t){return e("root","root"),n=k.init(t),n},t.router=L,Object.defineProperty(t,"__esModule",{value:!0})}(e)},function(t,e,n){"use strict";n.r(e);var i=n(0);var s=[{name:"plantform_list",activeWhen:function(t){return"plantform_list"===window.location.href.split(window.location.origin)[1].split("/")[1]},domain:"http://localhost:8081",entry:"/plantform_list/stats.js",prop:{},context:"vue",version:"2.6.2"},{name:"yueqi",activeWhen:function(t){return"yueqi"===window.location.href.split(window.location.origin)[1].split("/")[1]},domain:"http://localhost:8081",entry:"/yueqi/stats.js",prop:{},context:"vue",version:"2.6.2"},{name:"jinzhao",activeWhen:function(t){return"jinzhao"===window.location.href.split(window.location.origin)[1].split("/")[1]},domain:"http://localhost:8082",entry:"/jinzhao/stats.js",context:"vue",version:"2.6.2"},{name:"blue",activeWhen:function(t){return"blue"===window.location.href.split(window.location.origin)[1].split("/")[1].split("?")[0]},domain:"http://localhost:8007",entry:"/rcms/stats.js"}];var o=class{setModuleMap(t,e){const n=new Map;let i=[];for(;t;){if(n.set(t.name,e.get(t.name)),t.children&&t.children.length>0)for(let e=0;e<t.children.length;e++)i.push(t.children[e]);t=i.shift()}return n}setProjectMap(t){const e=new Map;for(let n in t)e.set(t[n].name,t[n]);return e}};var a=class extends o{constructor(t,e){super(),this.projectMap=this.setProjectMap(t),this.plantformTree=e,this.moduleMap=this.setModuleMap(this.plantformTree.projects[0],this.projectMap),console.log(this.moduleMap)}push(t){switch(t){case"next":this.next();break;case"back":this.back();default:this.go(t)}}go(t){i.router.push("/"+t)}next(){const t=i.$data.plantform.current;t.next&&i.router.push("/"+t.next)}back(){const t=i.$data.plantform.current;t.return&&i.router.push("/"+t.return)}};Object(i.registerApps)(s),i.invoke.mode="safe";const r={projects:[{name:"plantform_list",children:[{name:"circle1",children:[{name:"template1",props:[{key:"current",type:"number",require:!0,spacename:"global",description:""},{key:"total",type:"number",require:!0,spacename:"template1",description:""}]},{name:"template2",props:[{key:"current",type:"number",require:!0,spacename:"global",description:""}]}]}]},{name:"project2"},{name:"project3"}],current:{}};new a(s,r);i.$data.set({plantform:r},"global"),console.log(i.$data)}]);
//# sourceMappingURL=app.js.map